<!-- 简化的搜索页面 -->
<view class="container">
	<!-- 导航栏和搜索框 -->
	<nav-bar title="探索" showBack="{{true}}" />
	
	<search-bar
		value="{{searchValue}}"
		placeholder="搜索校园知识"
		focus="{{false}}"
		show-action="{{false}}"
		bindinput="onSearchInput"
		bindclear="clearSearch"
		bindconfirm="search"
		bindselect="onSearchSelect"
		options="{{searchOptions}}"
	/>

	<!-- 搜索建议
	<view class="search-suggestions" wx:if="{{suggestions.length > 0 && searchValue && !isSearching}}">
		<view 
			class="suggestion-item" 
			wx:for="{{suggestions}}" 
			wx:key="index"
			bindtap="onSuggestionTap"
			data-keyword="{{item}}"
		>
			<icon name="search" size="32" />
			<text>{{item}}</text>
		</view>
	</view>
	 -->
	<!-- 热门搜索和历史 -->
	<block wx:if="{{!isSearching && !searchValue}}">
		<!-- 热门搜索 -->
		<view class="hot-searches" wx:if="{{hotSearches.length > 0}}">
			<view class="section-title">热门搜索</view>
			<view class="hot-list">
				<view 
					class="hot-item" 
					wx:for="{{hotSearches}}" 
					wx:key="index"
					bindtap="onHotSearchTap"
					data-keyword="{{item.keyword || item}}"
				>
					<text class="hot-rank {{index < 3 ? 'top' : ''}}">{{index + 1}}</text>
					<text>{{item.keyword || item}}</text>
					<text wx:if="{{item.count}}" class="count">{{item.count}}</text>
				</view>
			</view>
		</view>

		<!-- 搜索历史 -->
		<view class="search-history" wx:if="{{searchHistory.length > 0}}">
			<view class="section-title">
				<text>搜索历史</text>
				<text class="clear-btn" bindtap="clearSearchHistory">清空</text>
			</view>
			<view class="history-list">
				<view 
					class="history-item" 
					wx:for="{{searchHistory}}" 
					wx:key="index"
					bindtap="onHistoryItemTap"
					data-keyword="{{item}}"
				>{{item}}</view>
			</view>
		</view>
	</block>

	<!-- 加载中 -->
	<view class="loading" wx:if="{{isSearching}}">
		<view class="loading-icon"></view>
		<text>搜索中...</text>
	</view>

	<!-- 搜索结果 -->
	<view class="search-content" wx:if="{{!isSearching && (searchResults.length > 0 || showRagResults)}}">
		<!-- RAG查询回答 -->
		<block wx:if="{{showRagResults}}">
			<text-area 
				value="{{ragResults}}" 
				readOnly="{{true}}" 
				markdownMode="{{true}}"
				height="{{500}}"
				showToolbar="{{false}}"
			></text-area>
		</block>
		
		<!-- 结果摘要 -->
		<view class="result-summary" wx:if="{{!showRagResults}}">
			找到 {{pagination.total || searchResults.length}} 条结果
		</view>
		
		<!-- 统一的来源列表 -->
		<view wx:if="{{(showRagResults && ragSources && ragSources.length > 0) || (!showRagResults && searchResults.length > 0)}}">
			<view class="section-title">信息来源</view>
			<source-list 
				sources="{{showRagResults ? ragSources : searchResults}}" 
				binditemtap="{{showRagResults ? 'onRagSourceTap' : 'onResultTap'}}"
				show-rank="{{true}}"
			/>
		</view>
		
		<!-- 建议问题 -->
		<view class="suggest-questions" wx:if="{{ragSuggestions && ragSuggestions.length > 0}}">
			<view class="section-title">你可能还想了解</view>
			<view class="question-list">
				<view 
					class="question-item" 
					wx:for="{{ragSuggestions}}" 
					wx:key="index"
					bindtap="onRagSuggestionTap"
					data-question="{{item}}"
				>
					<icon name="question" size="28" />
					<text>{{item}}</text>
				</view>
			</view>
		</view>
		
		<!-- 分页控制 -->
		<view class="pagination" wx:if="{{!showRagResults && searchResults.length > 0}}">
			<view class="load-more" wx:if="{{pagination.has_more}}" bindtap="loadMore">加载更多</view>
			<view class="no-more" wx:else>没有更多结果了</view>
		</view>
	</view>

	<!-- 无结果状态 -->
	<!-- 已执行搜索但没有结果 -->
	<view class="no-result" wx:if="{{!isSearching && searchValue && !searchResults.length && !showRagResults && hasSearched}}">
		<icon name="empty" size="64" />
		<text>暂无搜索结果</text>
	</view>
	
	<!-- 输入了关键词但尚未搜索 -->
	<view class="search-tips" wx:if="{{!isSearching && searchValue && !hasSearched && !showRagResults}}">
		<icon name="search" size="64" color="#cccccc" />
		<text>输入关键词后，按回车键开始搜索</text>
	</view>
</view>