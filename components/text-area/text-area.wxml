<view class="text-area-container">
  <!-- æ˜¾ç¤ºé¢„è§ˆå†…å®¹æˆ–æ–‡æœ¬åŒºåŸŸ -->
  <block wx:if="{{!showPreview && !readOnly}}">
    <textarea
      class="text-area {{markdownMode ? 'markdown-editor' : ''}}"
      style="height: {{_height}}rpx;"
      placeholder="{{markdownMode ? 'ä½¿ç”¨ # ä½œä¸ºæ ‡é¢˜ ## ä½œä¸ºäºŒçº§æ ‡é¢˜ æ­£æ–‡å†…å®¹...' : placeholder}}"
      value="{{value}}"
      maxlength="{{maxlength}}"
      auto-height="{{autoHeight}}"
      disabled="{{disabled}}"
      focus="{{focus}}"
      show-confirm-bar="{{false}}"
      adjust-position="{{adjustPosition}}"
      bindinput="onInput"
      bindfocus="onFocus"
      bindblur="onBlur"
      bindconfirm="onConfirm"
      space="{{space}}"
    ></textarea>
  </block>
  <block wx:else>
    <!-- åŠ è½½ä¸­æ˜¾ç¤º -->
    <view wx:if="{{rendering}}" class="loading-container" style="height: {{_height}}rpx;">
      <view class="loading-icon"></view>
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>
    

    <!-- ä½¿ç”¨towxmlä½œä¸ºå¤‡é€‰ -->
    <scroll-view 
      wx:elif="{{markdownNodes && value && value.trim() !== ''}}" 
      scroll-y="{{!fixedHeight && scroll !== false}}" 
      class="markdown-preview {{readOnly ? 'read-only' : ''}} {{fixedHeight || scroll === false ? 'no-scroll' : ''}}" 
      style="height: {{fixedHeight ? _height + 'rpx' : 'auto'}}; max-height: {{_height}}rpx;">
      <view class="{{fixedHeight || scroll === false ? 'no-scroll-view' : ''}}">
        <towxml nodes="{{markdownNodes}}"/>
      </view>
    </scroll-view>
    
    <!-- çº¯æ–‡æœ¬æ˜¾ç¤º -->
    <scroll-view 
      wx:elif="{{!markdownMode && value && value.trim() !== ''}}" 
      scroll-y="{{!fixedHeight && scroll !== false}}" 
      class="text-preview {{readOnly ? 'read-only' : ''}} {{fixedHeight || scroll === false ? 'no-scroll' : ''}}" 
      style="height: {{fixedHeight ? _height + 'rpx' : 'auto'}}; max-height: {{_height}}rpx;">
      <view class="{{fixedHeight || scroll === false ? 'no-scroll-view' : ''}}">
        <text>{{value}}</text>
      </view>
    </scroll-view>
    
    <!-- æ— å†…å®¹æ˜¾ç¤º -->
    <view wx:else class="empty-preview" style="height: {{readOnly ? 'auto' : (_height > 100 ? '100rpx' : _height+'rpx')}}">
      <text>{{readOnly ? 'æš‚æ— å†…å®¹' : ''}}</text>
    </view>
  </block>

  <!-- è®¡æ•°å™¨ -->
  <view class="counter" wx:if="{{showCount && !showPreview && !readOnly}}">
    <text>{{currentLength}}/{{maxlength}}</text>
  </view>

  <!-- å·¥å…·æ  -->
  <view class="toolbar" wx:if="{{showToolbar && !readOnly}}">
    <!-- å®Œæ•´å·¥å…·æ  -->
    <block wx:if="{{!simpleToolbar}}">
      <view class="tool-item" bindtap="onBoldTap">
        <text class="tool-icon">B</text>
      </view>
      <view class="tool-item" bindtap="onItalicTap">
        <text class="tool-icon">I</text>
      </view>
      <view class="tool-item" bindtap="onImageTap">
        <text class="tool-icon">ğŸ“·</text>
      </view>
      <view class="tool-item" bindtap="onAtTap">
        <text class="tool-icon">@</text>
      </view>
    </block>
    
    <!-- é¢„è§ˆæŒ‰é’®å§‹ç»ˆæ˜¾ç¤º -->
    <view class="tool-item {{showPreview ? 'active' : ''}} {{simpleToolbar ? 'preview-only' : ''}}" bindtap="togglePreview">
      <text class="tool-icon">ğŸ‘ï¸</text>
    </view>
  </view>
</view> 