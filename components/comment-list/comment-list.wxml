<!-- 评论列表组件 -->
<view class="comment-section">
  <view class="section-header">
    <text class="section-title">评论 ({{total || 0}})</text>
  </view>

  <!-- 加载状态 -->
  <view class="loading-container" wx:if="{{loading && comments.length === 0}}">
    <view class="loading-spinner"></view>
    <view class="loading-text">加载中...</view>
  </view>

  <!-- 错误状态 -->
  <view class="error-message" wx:elif="{{error}}">
    <view class="error-icon">
      <icon name="error" size="48"></icon>
    </view>
    <view class="error-text">{{errorMsg || '加载失败'}}</view>
    <view class="error-btn" bindtap="retry">重试</view>
  </view>

  <!-- 空状态 -->
  <view class="empty-container" wx:elif="{{comments.length === 0}}">
    <view class="empty-icon">
      <icon name="comment" size="48"></icon>
    </view>
    <view class="empty-text">暂无评论，快来抢沙发吧</view>
  </view>

  <!-- 评论列表 -->
  <view class="comment-list" wx:elif="{{comments && comments.length > 0}}">
    <comment-item 
      wx:for="{{comments}}" 
      wx:key="id"
      comment="{{item}}"
      bind:reply="handleReply"
      bind:like="handleLike"
      bind:delete="handleDelete"
      bind:user="goToUserProfile"
      class="comment-item comment-item-{{item.id}} {{item.highlighted ? 'highlighted' : ''}}"
    ></comment-item>
  </view>

  <!-- 加载更多 -->
  <view class="load-more" wx:if="{{hasMore}}" bindtap="loadMore">
    <view wx:if="{{loading}}" class="loading-more">
      <view class="loading-spinner small"></view>
      <text>加载中...</text>
    </view>
    <view wx:else class="load-more-text">
      <text>加载更多</text>
    </view>
  </view>

  <!-- 到底提示 -->
  <view class="end-text" wx:elif="{{comments.length > 0}}">
    <text>已经到底了</text>
  </view>
  
  <!-- 评论输入区域 -->
  <view class="comment-input-area">
    <view class="comment-input-container">
      <input 
        class="comment-input" 
        placeholder="{{replyTo ? '回复 @' + replyTo.nickname : '写评论...'}}" 
        value="{{commentText}}"
        focus="{{commentFocus}}"
        bindfocus="onCommentFocus"
        bindinput="onCommentInput"
        confirm-type="send"
        bindconfirm="submitComment"
      />
      
      <!-- 取消回复按钮，仅在回复模式下显示 -->
      <view 
        class="cancel-reply-btn" 
        wx:if="{{replyTo}}"
        bindtap="cancelReply">
        <icon name="close" size="16"></icon>
      </view>
      
      <!-- 发送按钮 -->
      <view 
        wx:if="{{!commentText || !commentText.trim()}}"
        class="submit-btn" 
        bindtap="submitComment"
        data-disabled="true">
        <text>发送</text>
      </view>
      <view 
        wx:else
        class="submit-btn active" 
        style="background-color: #07c160; color: #ffffff; font-weight: 500;"
        bindtap="submitComment"
        data-disabled="{{isSubmitting}}">
        <text>发送</text>
      </view>
    </view>
  </view>
</view> 